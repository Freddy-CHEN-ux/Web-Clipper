# 连续无故障时长特性设计方案 - 新能源云平台与APP开发团队 - Confluence
**需求：** ESAAS-13669

**现有逻辑**-如果存在未恢复的告警无故障时长就是0；如果当前没有未恢复的告警，查看最近一次故障恢复时间，取该故障恢复时间到当前时间的时长。如果没有告警信息，就取创建时间到当前时间的时长。

**更改逻辑**-不用告警统计（经常有告警恢复不了，但实际可以正常工作了），用桩+枪状态判断

桩：当前是故障状态（2），无故障时长就是0。当前是非故障状态，查看桩或任何一个枪上一次故障状态时间的后一个非故障状态时间到当前时间的时长。如果没有故障状态数据，就取第一个状态时间到当前时间的时长。

  
枪：当前是故障状态（8），无故障时长就是0。当前是非故障状态，查看上一次故障状态时间的后一个非故障状态时间到当前的时间。如果没有产生过故障状态，就取第一个状态时间到当前时间的时长。

**注意**：对于交流桩，因为没有单独的桩状态，所以桩和枪是一样的。

**实现**：

直流桩-查询ES索引pile\_work\_status_his数据，进行逻辑判断返回。

交流桩-查询ES索引op\_evse\_status\_record\_index数据，进行逻辑判断返回。